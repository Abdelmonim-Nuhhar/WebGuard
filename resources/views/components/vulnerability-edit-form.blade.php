<link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">

<div id="vulnerabilityEdit" class="p-6 w-full lg:w-2/3">
    <!-- form content goes here -->
    <div class="productlist p-2">
        @if ($errors->any())
        <div class="bg-red-600 border-solid rounded-md border-2 border-red-700">
            <ul>
                @foreach ($errors->all() as $error)
                <li class="text-lg text-gray-100">{{ $error }}</li>
                @endforeach
            </ul>
        </div>
        @endif
        <form method="POST" action="">
            @method('PUT')
            @csrf
            <div class="p-2 m-2 rounded-lg shadow-lg bg-gray-50 border-2 border-blue-900 max-w-md">
                <div class="font-bold text-sm mb-2">
                    <input class="appearance-none block w-full bg-grey-lighter text-grey-darker border border-red rounded py-3 px-4 mb-3" value="{{ $vulnerability->name }}" id="name" name="name" type="text" placeholder="V-Name">
                </div>
                <p class="text-gray-700 text-sm">
                    <input class="appearance-none block w-full bg-grey-lighter text-grey-darker border border-red rounded py-3 px-4 mb-3" value="{{ $vulnerability->severity }}" id="severity" name="severity" type="text" placeholder="V-Severity">
                </p>
                <p class="text-gray-700 text-sm">
                    <textarea class="appearance-none block w-full bg-grey-lighter text-grey-darker border border-red rounded py-3 px-4 mb-3" cols="30" rows="10" id="mitigation" name="mitigation" type="text" placeholder="V-Mitigation">{{ $vulnerability->mitigation }}</textarea>
                </p>
                <p class="text-gray-700 text-sm">
                    <input class="appearance-none block w-full bg-grey-lighter text-grey-darker border border-red rounded py-3 px-4 mb-3" value="{{ $vulnerability->is_fixed }}" id="is_fixed" name="is_fixed" type="number" min="0" max="1" placeholder="Fix Status">
                </p>
                <p class="text-gray-700 text-sm">
                    <textarea class="appearance-none block w-full bg-grey-lighter text-grey-darker border border-red rounded py-3 px-4 mb-3" id="description" name="description" placeholder="V - Description" cols="30" rows="10">{{ $vulnerability->description }}</textarea>
                </p>
                <div class="flex items-center justify-between mt-4">
                    <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded text-xs uppercase hover:underline font-semibold">Update</button>
                    <button value="{{ $vulnerability->id }}" type="button" class="bg-red-400 text-white px-4 py-2 rounded text-xs uppercase hover:underline font-semibold remove-v">Remove</button>
                </div>
            </div>
        </form>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
    window.onload = function () {
        document.addEventListener('change', e => {
            if (e.target.matches('select.select-box')) {
                //example for dropdown list event
            }
        });
        document.addEventListener('click', e => {
            if (e.target.matches('button.remove-v')) {
                deleteProductByID(e.target.value);
            }
        });
    }

    async function deleteProductByID(id) {
        try {
            const response = await axios.delete("/vulnerabilities/" + id);

            if (response.data.msg === "success") {
                alert("Successfully Deleted");
                window.location = "/vulnerabilities";
            } else {
                alert("Delete operation failed.");
            }
        } catch (error) {
            console.error("Error deleting product:", error);
            alert("An error occurred while deleting the product, OR YOU ARE NOT ADMIN.");
        }
    }
</script>
